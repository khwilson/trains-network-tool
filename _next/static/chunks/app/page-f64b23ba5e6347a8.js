(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{284:function(t,e,o){Promise.resolve().then(o.bind(o,4290))},4290:function(t,e,o){"use strict";o.r(e),o.d(e,{default:function(){return Home}});var n=o(7437),s=o(9778),c=o(2904),i=o(2265),r=o(7042),l=o(4355);function computeShortestPaths(t){let e={};for(let o of Object.values(t))e[o.fromCity]=[],e[o.toCity]=[];for(let o of Object.values(t))o.isOn&&(e[o.fromCity].push({out:o.toCity,distance:o.distance}),e[o.toCity].push({out:o.fromCity,distance:o.distance}));let o={};for(let t of Object.keys(e)){let n={},s=new l.PriorityQueue((t,e)=>t.distance>e.distance?1:-1);for(s.enqueue({path:[t],distance:0});s.size()>0;){let{path:t,distance:o}=s.dequeue(),c=t[t.length-1];if(void 0===n[c])for(let i of(n[c]={path:t,distance:o},e[c]))s.enqueue({path:[...t,i.out],distance:o+i.distance})}o[t]=n}return o}function computeRouteStatistics(t){let{shortestPaths:e,cities:o,metcalfe:n={coeff:75e3,power:.8},financial:s={operatingCostPerKm:.07,maxProfitPerPassenger:50,baseFarePerKm:.135}}=t,c={},{coeff:i,power:r}=n,{operatingCostPerKm:l,maxProfitPerPassenger:a,baseFarePerKm:d}=s;if(!o)return c;for(let t of Object.keys(e)){c[t]={};let n=e[t];for(let e of Object.keys(n)){let{path:s,distance:u}=n[e],h=Math.pow(u<500?500:u,2);if(!o[t]||!o[e])return{};let p=1e6*(i*Math.pow(o[t].population/1e6,r)*Math.pow(o[e].population/1e6,r))/h,f=l*u,m=f+a,j=d*u,x=m<j?m:j;c[t][e]={fromCityPop:o[t].population,toCityPop:o[e].population,ridership:p,path:s,distance:u,operatingCostPerPassenger:f,maxFare:m,proposedFare:j,fare:x,profitPerPassenger:x-f,totalProfit:(x-f)*p}}}return c}function computeSegmentStatistics(t){let{routeStatistics:e,segments:o}=t,n={};for(let t of Object.keys(e)){let s=e[t];for(let t of Object.keys(s)){let{ridership:e,path:c,totalProfit:i,distance:r}=s[t];for(let t=0;t<c.length-1;++t){let s="".concat(c[t]," - ").concat(c[t+1]),l=o[s];l||(l=o[s="".concat(c[t+1]," - ").concat(c[t])]);let a=n[s];a||(a={ridership:0,totalProfit:0,cost:l.cost},n[s]=a),a.ridership+=e/2,a.totalProfit+=i*(l.distance/r)/2}}}return n}function Home(){let[t,e]=(0,i.useState)({}),[o,l]=(0,i.useState)({});(0,i.useEffect)(()=>{(0,c.gy)("/segments.csv",t=>({name:"".concat(t.from_city," - ").concat(t.to_city),fromCity:t.from_city,toCity:t.to_city,distance:+t.distance,cost:+t.cost,isOn:!0})).then(t=>{let e={};for(let o of t)e["".concat(o.fromCity," - ").concat(o.toCity)]=o;l(e)})},[]),(0,i.useEffect)(()=>{(0,c.gy)("/cities.csv",t=>({city:t.city,state:t.state,population:+t.population,lng:+t.lng,lat:+t.lat})).then(t=>{let o={};t.map(t=>o[t.city]=t),e(o)})},[]);let flipSegmentParity=t=>{l({...o,[t]:{...o[t],isOn:!o[t].isOn}})},a=(0,i.useMemo)(()=>{let e=computeShortestPaths(o),n=computeRouteStatistics({shortestPaths:e,cities:t}),s=computeSegmentStatistics({routeStatistics:n,segments:o});return{shortestPaths:e,routeStatistics:n,segmentStatistics:s}},[o,t]);return(0,n.jsxs)("main",{className:"grid grid-cols-4 min-h-screen p-6",children:[(0,n.jsx)("div",{className:"col-start-2 col-end-4",children:(0,n.jsxs)(s.ComposableMap,{projection:"geoAlbers",projectionConfig:{center:[0,40]},children:[(0,n.jsx)(s.Geographies,{geography:"/states.json",children:t=>{let{geographies:e}=t;return e.map(t=>(0,n.jsx)(s.Geography,{geography:t,fill:"#ddd",stroke:"#000",style:{default:{outline:"none"},hover:{outline:"none"},pressed:{outline:"none"}},tabIndex:-1},t.rsmKey))}}),Object.values(t).map((t,e)=>{let{lng:o,lat:c}=t;return(0,n.jsx)(s.Marker,{coordinates:[o,c],children:(0,n.jsx)("circle",{r:4,stroke:"#fff",strokeWidth:2,fill:"#f00"})},"cities-".concat(e))}),Object.values(o).map((e,o)=>{let{fromCity:c,toCity:i,isOn:l}=e,a=t[c],d=t[i],u="".concat(c," - ").concat(i);if(!a||!d)return(0,n.jsx)(n.Fragment,{});let h=[a.lng,a.lat],p=[d.lng,d.lat];return(0,n.jsx)(s.Line,{onClick:()=>flipSegmentParity(u),coordinates:[h,p],stroke:(0,r.Z)({"#000":!l,"#0f0":l})},"segment-".concat(o))})]})}),(0,n.jsx)("div",{className:"col-start-1 col-end-5",children:(0,n.jsxs)("table",{children:[(0,n.jsx)("thead",{children:(0,n.jsxs)("tr",{children:[(0,n.jsx)("td",{children:"From"}),(0,n.jsx)("td",{children:"To"}),(0,n.jsx)("td",{children:"Cost ($b)"}),(0,n.jsx)("td",{children:"Ridership (m)"}),(0,n.jsx)("td",{children:"Total Profit ($m)"}),(0,n.jsx)("td",{children:"ROI (%)"})]})}),(0,n.jsx)("tbody",{children:Object.keys(a.segmentStatistics).map((t,e)=>{let o=a.segmentStatistics[t],[s,c]=t.split(" - ");return(0,n.jsxs)("tr",{children:[(0,n.jsx)("td",{children:s},"output-segment-td-from-".concat(e)),(0,n.jsx)("td",{children:c},"output-segment-td-to-".concat(e)),(0,n.jsx)("td",{children:(o.cost/1e9).toFixed(2)},"output-segment-td-cost-".concat(e)),(0,n.jsx)("td",{children:(o.ridership/1e6).toFixed(3)},"output-segment-td-ridership-".concat(e)),(0,n.jsx)("td",{children:(o.totalProfit/1e6).toFixed(2)},"output-segment-td-totalprofit-".concat(e)),(0,n.jsx)("td",{children:(100*(o.totalProfit-o.cost)/o.cost).toFixed(1)},"output-segment-td-roi-".concat(e))]},"output-segment-tr-".concat(e))})})]})}),(0,n.jsx)("div",{className:"col-start-1 col-end-5",children:(0,n.jsxs)("table",{children:[(0,n.jsx)("thead",{children:(0,n.jsxs)("tr",{children:[(0,n.jsx)("td",{children:"From"}),(0,n.jsx)("td",{children:"To"}),(0,n.jsx)("td",{children:"Distance"}),(0,n.jsx)("td",{children:"Cost"})]})}),(0,n.jsx)("tbody",{children:Object.values(o).map((t,e)=>(0,n.jsxs)("tr",{children:[(0,n.jsx)("td",{children:t.fromCity},"input-segment-td-from-".concat(e)),(0,n.jsx)("td",{children:t.toCity},"input-segment-td-to-".concat(e)),(0,n.jsx)("td",{children:t.distance},"input-segment-td-dist-".concat(e)),(0,n.jsx)("td",{children:(0,n.jsx)("input",{value:t.cost,onChange:e=>l(o=>({...o,[t.name]:{...t,cost:+e.target.value}}))})},"input-segment-td-cost-".concat(e))]},"input-segment-tr-".concat(e)))})]})}),(0,n.jsx)("div",{className:"col-start-1 col-end-5",children:(0,n.jsxs)("table",{children:[(0,n.jsx)("thead",{children:(0,n.jsxs)("tr",{children:[(0,n.jsx)("td",{children:"Name"}),(0,n.jsx)("td",{children:"Population"})]})}),(0,n.jsx)("tbody",{children:Object.values(t).map((t,e)=>(0,n.jsxs)("tr",{children:[(0,n.jsx)("td",{children:t.city},"td-name-".concat(e)),(0,n.jsx)("td",{children:t.population},"td-population-".concat(e))]},"tr-".concat(e)))})]})})]})}}},function(t){t.O(0,[290,971,472,744],function(){return t(t.s=284)}),_N_E=t.O()}]);